@model MusicStoreEntity.Album
@{
    ViewBag.Title = "专辑明细";
    Layout = "~/Views/Shared/_NewLayout.cshtml";
}

<h2>@Model.Title</h2>
<div id="box-video">
    <div class="cd" style="background: url(@(Model.AlbumArtUrl)) no-repeat;">
        <div class="cd-center">
            <audio src="@Model.MusicUrl" controls autoplay loop></audio>
        </div>
    </div>
</div>
<div id="album-details">
    <p>
        <em>发布时间</em>
        @Model.PublisherDate.ToString("yyyy年MM月dd日");
    </p>
    <p>
        <em>分类</em>
        @Model.Genre.Name
    </p>
    <p>
        <em>歌手</em>
        @Model.Artist.Name
    </p>
    <p>
        <em>价格</em>
        $@String.Format("{0:F}", Model.Price)
    </p>
    <div id="msg"></div>
    <p class="button">
        <a class="btn" id="addcart">添加到购物车</a>
        <div id="msg">

        </div>
    </p>
</div>
<div class="row">
    <div class="col-md-10">
        <div class="form-group">
            <textarea id="editor" name="editor"></textarea>
        </div>

        <button id="btnCmt" type="button" class="btn btn-success">评论</button>
    </div>
</div>
   <script>
       //百度编辑器调用
       var editor = new baidu.editor.ui.Editor({
           UEDITOR_HOME_URL: '/ueditor/',
           iframeCssUrl: '/Content/ueditor1_4_3-utf8-net/themes/iframe.css/',
           initialContent: '五星好评',
           autoHeightEnabled: true,
           minFrameHeight: 500


       });
       editor.render('editor');
       //提交回复
       $("#btnCmt").click(function () {
           UE.getEditor("editor");
           var content = UE.getEditor("editor").getContent();
           $.ajax({
               type: 'post',
               asyn: true,
               url:@Url.Action("AddCmt","Store"),
               data:{
               "id":"@Model.ID",
                   "cmt":content,
                   "reply":""
               },
               dataType:'json',
               success:function(data){
                   if(data=='nologon'){
                       //如果没登录
                       location.href="@Url.Action("login","Account",
                       new {returnUrl=Url.Action("Detail","Store",new {id=Model.ID})})";
                   }
                   else if(data=="OK"){
                       alert('发表成功!');
                       //局部刷新
                   }
               }
           })
       })
   </script>


<script>
    $("#addcart").click(function () {
        //异步
        $("#msg").html("<img src='../../content/images/ProgressIcon.gif' />添加到购物车,请稍后...");
        $.ajax({
            type: 'post',
            async: true,
            url: '../../ShoppingCart/AddCart',
            data:{id:"@Model.ID"},
            dataType:'json',
            success: function (data)
            {
                if (data == "nologin")
                {
                  
                    location.href= "@Url.Action("Login", "Account", new { returnUrl = Url.Action("Detail", "Store", new { id = Model.ID }) })";
                 

                }

                else
                {
                    $("#msg").html(data);
                    //location.reload();
                }
            }
        });
    });

</script>